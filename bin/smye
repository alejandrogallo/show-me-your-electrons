#! /usr/bin/env python

import sys
import smye
import argparse

############################
#  ADDITIONAL INFORMATION  #
############################

SETUP_INFO  = smye.SETUP_INFO
DESCRIPTION = SETUP_INFO["description"]
EPILOG      = """

This program is maintained by %s at %s.

"""%(SETUP_INFO["author"], SETUP_INFO["url"])


############################################
#  ARGUMENT PARSER AND OPTION DEFINITIONS  #
############################################

parser = argparse.ArgumentParser(description=DESCRIPTION, epilog=EPILOG)

parser.add_argument("--version", help="Print version and exit", action="store_true")
parser.add_argument("-v", "--verbose", help="Make the output verbose", action="store_true")
parser.add_argument("--ascii", help="Print the electron configuration in ascii format", action="store_true")
parser.add_argument("file", help="Input file (in OUTCAR format)", default=None, nargs="?")
parser.add_argument("-g", "--gap", help="Get band gap", action="store_true")
parser.add_argument("-n", "--excited", help="Get nth excited energy (from above)", type=int, action="store")
parser.add_argument("-s", "--spin", help="Together with -n, spin channel (1 or 2)",   action="store")
parser.add_argument("-t", "--test", help="For testing",   action="store_true")
parser.add_argument("-a", "--all", help="Gett all states from the highes occuppied -min + max ",   type=int, nargs="+", action="store")
parser.add_argument("--no-polarised", help="Parse information from no polarised calculations", action="store_true")


args = parser.parse_args()



if args.version:
    print(SETUP_INFO["version"])
    sys.exit(1)

if args.verbose:
    print(smye.LOGO)
    print("Making the output verbose...")
    smye.VERBOSE=True
else:
    smye.VERBOSE=False

if args.file:
    diagram = smye.Diagram(args.file)
else:
    print("No input file provided!")
    sys.exit(1)

if args.test:
    print(diagram.getLastOccuppiedStates("1"));
    print(diagram.getLastOccuppiedStates("2"));
    if args.excited:
        print(diagram.getNthExcitedState(args.excited, "1"));
        print(diagram.getNthExcitedState(args.excited, "2"));
    sys.exit(0)
if args.all:
    down_offset = args.all[0]
    try:
        up_offset = args.all[1]
    except:
        up_offset = 0
    diagram.printAllLastNStates(down_offset, up_offset)

if args.ascii:
    print("Displaying contents of %s in ascii"%args.file)
    diagram.showASCII()

if args.gap:
    diagram.getBandGap();

if args.excited and args.spin:
    print("both")
else:
    if args.excited:
        diagram.printNLastExcitedStates(args.excited)

